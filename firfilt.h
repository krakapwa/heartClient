#include <boost/circular_buffer.hpp>

#ifndef FIRFILT
#define FIRFILT

/*

FIR filter designed with
http://t-filter.appspot.com

sampling frequency: 250 Hz

* 0 Hz - 40 Hz
  gain = 1
  desired ripple = 5 dB
  actual ripple = 4.127356214567646 dB

* 41 Hz - 125 Hz
  gain = 0
  desired attenuation = -40 dB
  actual attenuation = -40.09791124967593 dB

*/

#define FILTER_TAP_NUM 247

static double filter_taps[FILTER_TAP_NUM] = {
  0.007890524000709977,
  0.003953937498264591,
  -0.00363624904698177,
  -0.01695338849143521,
  -0.030473606420062523,
  -0.03686033233534486,
  -0.03170704715546944,
  -0.01699673353279771,
  -0.00040873145816525206,
  0.009476032607705607,
  0.008812105833469797,
  0.0008264520166126201,
  -0.006934833778920138,
  -0.008351217990965006,
  -0.0030455112353983756,
  0.003972704731577473,
  0.006819994041402326,
  0.0035903676945542263,
  -0.002400687151291754,
  -0.005790500513330595,
  -0.003856733999099966,
  0.0013260682307461755,
  0.004982769525564019,
  0.003963082470658835,
  -0.0005666630333612466,
  -0.004366658301961752,
  -0.004041098845574959,
  -0.000057070300758921295,
  0.003815220285899773,
  0.004032299984394139,
  0.0005060558866368898,
  -0.003402273601789269,
  -0.004054418888500409,
  -0.0008988522379499146,
  0.0030688426766753963,
  0.0041332125969228825,
  0.0013213522726204189,
  -0.0027085003353720257,
  -0.004169460947233286,
  -0.0016965712805328001,
  0.002371091174120507,
  0.004192030714675333,
  0.0020408812672506435,
  -0.002062973549065381,
  -0.004243197971490819,
  -0.002410279430212386,
  0.0017409372638773923,
  0.004287660886639384,
  0.0027827571535410287,
  -0.0013977392404889895,
  -0.0043174762489367104,
  -0.003172266317938176,
  0.001030041400020559,
  0.0043349009641893,
  0.0035655029754702726,
  -0.0006230680851220391,
  -0.004320857432671277,
  -0.003963987440358904,
  0.0001984772690512159,
  0.004288676055897572,
  0.004380818529961498,
  0.00027167885972632667,
  -0.004226880200797845,
  -0.00481318651421883,
  -0.0008010468176436964,
  0.004109845380155971,
  0.005237991650509894,
  0.0013730130689596771,
  -0.003947283600496329,
  -0.005663642497127362,
  -0.0019936953600394364,
  0.003736515231223568,
  0.006094298900804172,
  0.0026776029761603638,
  -0.003458575447353009,
  -0.006518655092797299,
  -0.003425809591185466,
  0.00310778990854883,
  0.006936296347139806,
  0.004245462765921967,
  -0.002673589393119426,
  -0.007342149372910208,
  -0.005142403145981968,
  0.002143671356366644,
  0.007732305166793397,
  0.0061268806362950404,
  -0.0015078754847822984,
  -0.008112491465508936,
  -0.007224067199584244,
  0.0007387766956659138,
  0.008474778790254168,
  0.008454152342933795,
  0.0001968856325885837,
  -0.00881140295107315,
  -0.009846375019152904,
  -0.001329981728327197,
  0.009127219248483335,
  0.011452713815278683,
  0.00272500671505249,
  -0.009418767181534364,
  -0.013356442487170944,
  -0.004477221937234078,
  0.009683319677329211,
  0.01567886598392273,
  0.006738057009282468,
  -0.00991678502755131,
  -0.018639853831407562,
  -0.009773624537507485,
  0.010117169887408137,
  0.022638351462647973,
  0.014096124956887062,
  -0.01028434987756286,
  -0.02852886530752492,
  -0.02083109772917971,
  0.010418517212141458,
  0.038442570205413584,
  0.03304870497979562,
  -0.010513799286806118,
  -0.05962202776604807,
  -0.06301459151592914,
  0.010570043459697566,
  0.14281027844293778,
  0.270214786917532,
  0.32274424744840424,
  0.270214786917532,
  0.14281027844293778,
  0.010570043459697566,
  -0.06301459151592914,
  -0.05962202776604807,
  -0.010513799286806118,
  0.03304870497979562,
  0.038442570205413584,
  0.010418517212141458,
  -0.02083109772917971,
  -0.02852886530752492,
  -0.01028434987756286,
  0.014096124956887062,
  0.022638351462647973,
  0.010117169887408137,
  -0.009773624537507485,
  -0.018639853831407562,
  -0.00991678502755131,
  0.006738057009282468,
  0.01567886598392273,
  0.009683319677329211,
  -0.004477221937234078,
  -0.013356442487170944,
  -0.009418767181534364,
  0.00272500671505249,
  0.011452713815278683,
  0.009127219248483335,
  -0.001329981728327197,
  -0.009846375019152904,
  -0.00881140295107315,
  0.0001968856325885837,
  0.008454152342933795,
  0.008474778790254168,
  0.0007387766956659138,
  -0.007224067199584244,
  -0.008112491465508936,
  -0.0015078754847822984,
  0.0061268806362950404,
  0.007732305166793397,
  0.002143671356366644,
  -0.005142403145981968,
  -0.007342149372910208,
  -0.002673589393119426,
  0.004245462765921967,
  0.006936296347139806,
  0.00310778990854883,
  -0.003425809591185466,
  -0.006518655092797299,
  -0.003458575447353009,
  0.0026776029761603638,
  0.006094298900804172,
  0.003736515231223568,
  -0.0019936953600394364,
  -0.005663642497127362,
  -0.003947283600496329,
  0.0013730130689596771,
  0.005237991650509894,
  0.004109845380155971,
  -0.0008010468176436964,
  -0.00481318651421883,
  -0.004226880200797845,
  0.00027167885972632667,
  0.004380818529961498,
  0.004288676055897572,
  0.0001984772690512159,
  -0.003963987440358904,
  -0.004320857432671277,
  -0.0006230680851220391,
  0.0035655029754702726,
  0.0043349009641893,
  0.001030041400020559,
  -0.003172266317938176,
  -0.0043174762489367104,
  -0.0013977392404889895,
  0.0027827571535410287,
  0.004287660886639384,
  0.0017409372638773923,
  -0.002410279430212386,
  -0.004243197971490819,
  -0.002062973549065381,
  0.0020408812672506435,
  0.004192030714675333,
  0.002371091174120507,
  -0.0016965712805328001,
  -0.004169460947233286,
  -0.0027085003353720257,
  0.0013213522726204189,
  0.0041332125969228825,
  0.0030688426766753963,
  -0.0008988522379499146,
  -0.004054418888500409,
  -0.003402273601789269,
  0.0005060558866368898,
  0.004032299984394139,
  0.003815220285899773,
  -0.000057070300758921295,
  -0.004041098845574959,
  -0.004366658301961752,
  -0.0005666630333612466,
  0.003963082470658835,
  0.004982769525564019,
  0.0013260682307461755,
  -0.003856733999099966,
  -0.005790500513330595,
  -0.002400687151291754,
  0.0035903676945542263,
  0.006819994041402326,
  0.003972704731577473,
  -0.0030455112353983756,
  -0.008351217990965006,
  -0.006934833778920138,
  0.0008264520166126201,
  0.008812105833469797,
  0.009476032607705607,
  -0.00040873145816525206,
  -0.01699673353279771,
  -0.03170704715546944,
  -0.03686033233534486,
  -0.030473606420062523,
  -0.01695338849143521,
  -0.00363624904698177,
  0.003953937498264591,
  0.007890524000709977
};

class FirFilt
{
    public:
        FirFilt();
        FirFilt(double* a_, int n);
        ~FirFilt();
        double applyFilt(boost::circular_buffer<int> s);
    private:
        std::vector<double> a;
        int n;

};

#endif // FIRFILT

